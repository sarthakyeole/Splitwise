<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Add Expense - {{ group.name }}</title>
    <style>
      body { font-family: Arial, sans-serif; padding: 18px; }
      label { font-weight: bold; }
      .field { margin-bottom: 12px; }
      .error { color: #b00020; }
      .success { color: #0a7a0a; }
      .shares { margin-top: 10px; padding-left: 12px; }
      input[type="number"] { width: 120px; }
      .btn { padding: 8px 14px; background:#1976d2; color:white; border:none; border-radius:4px; cursor:pointer; }
      .btn:active { transform: translateY(1px); }
      
      /* Style radio buttons to be more visible */
      #id_split_type { display: flex; flex-direction: column; gap: 10px; margin-top: 8px; }
      #id_split_type label { 
        display: flex; 
        align-items: center; 
        padding: 10px; 
        border: 2px solid #ddd; 
        border-radius: 6px; 
        cursor: pointer;
        transition: all 0.2s;
      }
      #id_split_type label:hover { background-color: #f5f5f5; border-color: #1976d2; }
      #id_split_type input[type="radio"] { 
        margin-right: 10px; 
        width: 18px; 
        height: 18px; 
        cursor: pointer;
      }
      #id_split_type input[type="radio"]:checked + label,
      #id_split_type label:has(input[type="radio"]:checked) { 
        background-color: #e3f2fd; 
        border-color: #1976d2; 
        font-weight: bold;
      }
    </style>
</head>
<body>
    <h1>Add Expense in {{ group.name }}</h1>

    {% if messages %}
      {% for msg in messages %}
        <div class="{% if msg.tags %}{{ msg.tags }}{% endif %}">{{ msg }}</div>
      {% endfor %}
    {% endif %}

    {% if error %}
      <p class="error">{{ error }}</p>
    {% endif %}

    <form method="post" novalidate>
        {% csrf_token %}
        {{ form.non_field_errors }}

        <div class="field">
            {{ form.description.label_tag }}<br>
            {{ form.description }}<br>
            {% for e in form.description.errors %}<span class="error">{{ e }}</span>{% endfor %}
        </div>

        <div class="field">
            {{ form.amount.label_tag }}<br>
            {{ form.amount }}<br>
            {% for e in form.amount.errors %}<span class="error">{{ e }}</span>{% endfor %}
        </div>

        <div class="field">
            <label for="id_split_type_0" style="font-size: 16px; display: block; margin-bottom: 8px;">How do you want to split?</label>
            {{ form.split_type }}
            {% for e in form.split_type.errors %}<span class="error">{{ e }}</span>{% endfor %}
        </div>

        <div id="unequal_section" class="shares" style="display: none;">
            <h3>Enter each member's share</h3>
            {% for member in members %}
                <div>
                    <label for="id_share_{{ member.id }}">{{ member.username }}:</label>
                    <input id="id_share_{{ member.id }}" type="number" name="share_{{ member.id }}" step="0.01" min="0" value="0.00" />
                </div>
            {% endfor %}
            <p><small>Make sure the sum of shares equals the Expense amount.</small></p>
        </div>

        <div style="margin-top:14px;">
            <button type="submit" class="btn">Save</button>
            <a href="{% url 'group_detail' group.id %}" style="margin-left:12px;">Back to group</a>
        </div>
    </form>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const radios = document.getElementsByName("split_type");
        const section = document.getElementById("unequal_section");

        function updateVisibility() {
          // Check if 'unequal' radio is selected
          let isUnequal = false;
          for (let r of radios) {
            if (r.checked && r.value === 'unequal') {
              isUnequal = true;
              break;
            }
          }
          
          section.style.display = isUnequal ? "block" : "none";
        }

        // Attach change handlers to all radio buttons
        for (let r of radios) {
          r.addEventListener('change', updateVisibility);
        }

        // Set initial state
        updateVisibility();
      });
    </script>
</body>
</html>
