<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>{{ group.name }}</title>
</head>
<body>
  <h1>{{ group.name }}</h1>

  <h2>Who should pay whom</h2>

  {% if transactions %}
    <ul>
      {% for debtor, creditor, amount in transactions %}
        <li>
          <strong>{{ debtor.username }}</strong>
          should pay
          <strong>{{ creditor.username }}</strong>
          â‚¹{{ amount }}

          <form method="post"
                action="{% url 'quick_settle' group.id %}"
                style="display:inline;">
            {% csrf_token %}
            <input type="hidden" name="paid_by" value="{{ debtor.id }}">
            <input type="hidden" name="paid_to" value="{{ creditor.id }}">
            <input type="hidden" name="amount" value="{{ amount }}">
            <button type="submit">Settle</button>
          </form>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>All settled ðŸŽ‰</p>
  {% endif %}


  <h2>Balances</h2>
  {% if balance_entries %}
    <ul>
      {% for user, amount in balance_entries %}
        <li>
          {{ user.username }} : 
          {% if amount > 0 %} +{{ amount }} (should receive){% else %} {{ amount }} (owes){% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No balances yet.</p>
  {% endif %}

  <h2>Expenses</h2>
  {% if expenses %}
    <ul>
      {% for expense in expenses %}
        <li>
          <strong>{{ expense.description }}</strong> â€” {{ expense.amount }} 
          (paid by {{ expense.paid_by.username }})<br>

          <!-- per-expense split breakdown -->
          <em>Splits:</em>
          <ul>
            {% for split in expense.splits.all %}
              <li>{{ split.user.username }} : {{ split.amount }}</li>
            {% empty %}
              <li>No split details.</li>
            {% endfor %}
          </ul>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No expenses yet.</p>
  {% endif %}

  <p><a href="{% url 'add_expense' group.id %}">Add Expense</a></p>
  <p><a href="{% url 'dashboard' %}">Back to groups</a></p>
</body>
</html>
